# 代码风格规范——简约而不简单

一个项目代码的风格就如同一个人所展示出来的外观。代码风格之所以那么重要，是因为它往往决定了代码是否规范、是否易于阅读。代码虽然最终是要给机器看的，但毕竟还是面向程序猿们的编程，程序猿们是要陪伴整个项目开发过程的。在编写代码的过程中，尤其是在协作开发的过程中，如果对方的代码杂乱无章，读起来都费劲，更别说还需要在此基础上进一步开发，这对程序员不多的发量提出了巨大的挑战。好的代码风格不仅易于代码的阅读与移植，还能在很大程度上减少一些不必要的语法错误，例如少了 "}" ，如果在编码的时候严格遵循了花括号的对齐规则，那此类错误将容易被避免。



### 课程实验项目介绍

***本周实验目标***


* 本次实验将实现一个命令行的菜单小程序。最终目标是完成一个通用的命令行菜单子系统，便于在不同项目中重用。


* 在 hello world 小程序的不断生长过程中了解一个好的代码风格是什么样子的以及好的代码风格的重要性。


***本周实验要求***

* 参考视频演示按自己的方式实现一个命令行的菜单小程序，执行某个命令时调用一个特定的函数作为执行动作，实现的命令个数不少于8个；
* 评分标准：主要以是否符合代码风格规范为准；
* 思考：如何将代码模块化以包容变化？



### 代码最初是如何生长起来的

* 从 hello world 开始不断迭代调试使代码长的越来越像一个命令行的菜单小程序

* 写代码要小步快跑不断迭代，罗马不是一天建成的。

* 声明：做实际项目并不鼓励从头开始写代码，而是找已有的类似项目做逆向工程和再工程。

  

### menu菜单的初步形成

***以 hello.c 作为基础开始项目***

新建实验文件夹 lab2 并进入该目录，将上章实验结果 hello.c 拷贝过来，并重命名为 menu.c 。使用 gcc 将新建的menu.c 编译，并在成功编译后执行。

命令行：

```shell
cp ../lab1/hello.c menu.c
gcc menu.c -o menu
./menu
```

hello.c 内容：

```c
#incldue <stdio.h>

int main()
{
 	while(1)
    {								
        printf("hello world!\n");	//4个空格的缩进
    }   				//括号对齐
}
```

可以看到 shell 打印出 “hello world！” ，这证明这个小菜单是可以工作的！

***添加输入参数***

和生活中菜单类似，作为一个菜单小程序，需要具备根据用户点的菜（输入的参数），准确给出相应操作应答的功能。因此，我们需要给我们的小程序一个接收命令的变量 cmd 。为了能够有更直观的效果，我们将输出打印换为我们所输入的变量。

~~~c
incldue <stdio.h>
int main()
{
    char cmd[128];
 	while(1)
    {
        scanf("%s", cmd);    
        printf("%s\n", cmd);
	/*
        scanf("%s",cmd);
        printf("%s\n",cmd);
        变量与标点符号之间留有空格将增强代码的可阅读性
	*/
    }   
}
~~~

此时再编译运行，可看出 shell 总是会打印我们所输入的命令。这时的 menu 小程序已经初具雏形了，只不过还没能够为我们提供一些功能。

***为菜单配置一些功能***

我们想象中的菜单是可以根据用户的需要来提供一些服务的，比如在 shell 中一些命令如果后面跟 "help" 参数,将会打印出该命令的帮助信息，包括所有参数及其使用方法。下图为实验楼环境中查询 "ls" 命令的 "help" 帮助参数:
<br/>

<img src="https://github.com/galaxyxixi/menu_test/blob/master/pic/ls_help.png" width = "60%" div align=“center“>

<br/>
那我们如何才能实现根据对应功能作出回应操作呢？首先，我们需要将用户的输入参数与menu所知道的参数进行匹配，若是匹配成功，则做出相应的动作；如果不成功，也需要给出相应的提示表示目前还没有这个功能。

~~~c
#incldue <stdio.h>
#include <stdlib.h>

int main()
{
    char cmd[128];
 	while(1)
    {
        scanf("%s", cmd);  
        if(strcmp(cmd, "help") == 0)
        /*
        if(!strcmp(cmd, "help"))     使用逻辑尽可能简单的方法描述会使代码更容易理解
        */
        {
        	printf("This is help cmd\n", cmd);
        }
        else if(strcmp(cmd, "quit") == 0)
        {
            exit(0);  
        }
        else
        {
            printf("Wrong cmd!\n");
        }
    }   
}
~~~

<br/>

### 代码风格规范总结

***代码风格的原则：简明、易读、无二义性***

* [《构建之法》4.1代码规范](http://www.cnblogs.com/xinz/archive/2011/11/20/2255971.html)

***缩进、命名、注释等代码编排的风格规范***

* 缩进：4个空格

* 行宽：< 100个字符

* 在复杂的表达式中要用括号来清楚的表示逻辑优先级

* 花括号：所有  ‘{’  和  ‘}’  应独占一行且成对对齐

* 不要把多条语句和多个变量的定义放在同一行

* 命名：合适的命名会大大增加代码的可读性

    * 类型/类/函数名/变量名等的命名一定要与程序里的含义保持一致，以便于阅读理解
    
    * 类型的成员变量通常用m_或者_来做前缀
    
    * 一般变量使用LowerCamel风格，即第一个单词首字母小写，之后的单词都首字母大写，第一个单词一般都表示变量类型，比如int型变量iCounter
    
    * 类型/类/函数名一般都用Pascal风格，即所有单词首字母大写
    
    * 类型/类/变量一般用名词或者组合名词，如Member
    
    * 函数名一般使用动词或者动宾短语，如get/set，RenderPage
    
    * 注释和版权信息：注释也要使用英文，不要使用中文或特殊字符，要保持源代码是ASCII字符格式文件
    
    * 不要解释程序是如何工作的，要解释程序做什么，为什么这么做，以及特别需要注意的地方
    
    * 每个源文件头部应该有版权、作者、版本、描述等相关信息

    

### 章节小测试

1. 程序的分界符 ‘{’ 和 ‘}’ 应独占一行并且位于同一列，同时与引用它们的语句左对齐。{ } 之内的代码块在 ‘{’ 右边4个空格处左对齐。

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

2. 银弹不存在，我们需要的仅仅是明智的软件开发方法( smart software development )，软件必须从一个小的可运行的 skinny system 开始，逐渐充实生长称为 full-fledge 的成熟系统。

    <p align="left">----Ivar Jacobson（UML三巨头之一)</p>
    
    这句名言与我们本视频中从 hello world 开始逐渐充实生长的做法是一致的。
    
    a) ✅ &emsp;  &emsp;  b) ❌
       
3. 一般我们将代码按一定层次缩进以便于阅读理解代码，下列缩进方式描述正确的是

    a) 一个 tab 键 &emsp;  &emsp;  b) 2个空格  &emsp;  c) 4个空格 &emsp;  &emsp;  d) 8个空格

4. 判断下列代码在风格上哪种写法符合我们的课程要求

    a) 

    ```c
    if(condition)  dosomething();
    ```

    b) 

    ```c
    if(condition)  
       dosomething();
    ```

    c)

    ```c
    if(condition){
       dosomething();
    }  
    ```

    d)

    ```c
    if(condition)
    {
    	dosomething();
    }
    ```

5. 代码行内要适当多留空格，如“=”、“+=” “>=”、“<=”、“+”、“*”、“%”、“&&”、“||”、“<<”,“^”等二元操作符的前后应当加空格。

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

6. 遵守代码规范的主要目的是为了能编译出执行效率更高的可执行程序。

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

7. 对于表达式比较长的for语句和if语句，为了紧凑起见可以适当地去掉一些空格，如for (i=0; i<10; i++)和if ((a<=b) && (c<=d))

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

8. 代码一行最宽应该限制在多少个字符以内？

    a) 40&emsp;  &emsp;  b) 80  &emsp;  c) 100 &emsp;  &emsp;  d) 200

9. 很多程序员不太喜欢写注释，其实代码中写的注释越多越好！这句话正确吗？

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

10. 在一个函数体内，逻揖上密切相关的语句之间不加空行，其它地方应加空行分隔。

    a) ✅ &emsp;  &emsp;  b) ❌&emsp;  

      



正确答案：a a c d a ；b b c b a
